---
title: Create a proactive bot using Azure Bot Service | Microsoft Docs
description: Learn how to create a proactive bot using Azure Bot Service.
author: kbrandl
ms.author: v-kibran
manager: rstand
ms.topic: article
ms.prod: bot-framework
ms.date: 4/13/2017
ms.reviewer: 
ROBOTS: Index, Follow
---

# Create a bot using the Proactive template

Typically, each message that a bot sends to the user directly relates to the user's prior input. In some cases though, a bot may need to send the user information that is not directly related to the user's most recent message. These types of messages are called **proactive messages**. Proactive messages can be useful in a variety of scenarios. For example, if a bot sets a timer or reminder, it may need to notify the user when the time arrives. Or, if a bot receives a notification about an external event, it may need to communicate that information to the user. 

To create a bot that can send proactive messages to the user, choose the [Proactive template](~/azure/azure-bot-service-templates.md) when creating the bot using Azure Bot Service. This article describes the Azure resources that are created when you create a bot using the Proactive template and provides a walkthrough of the code that is automatically generated by the template.

## Azure resources

When you create a bot by using the Proactive template, several Azure resources are automatically created and added to your resource group. By default, these Azure resources are already configured to enable a very simple proactive messaging scenario. 

| Resource | Description |
|----|----|
| Azure Storage | Used to create the queue. |
| Azure Function App | A `queueTrigger` Azure Function that is triggered whenever there is a message in the queue. It communicates to the Azure Bot Service by using [Direct Line][directLine]. This function uses bot binding to send the message as part of the trigger’s payload. Our example function forwards the user’s message as-is from the queue.
| Azure Bot Service | Your bot. Contains the logic that receives the message from user, adds the message to the Azure queue, receives triggers from Azure Function, and sends back the message it received via trigger's payload. |

## Process overview

This diagram shows how triggered events work when you create a bot using the Proactive template.

![Overview of example Proactive Bot](~/media/azure-bot-proactive-diagram.png)

The process begins when the user sends a message to your bot via Bot Framework servers (step 1). The [Code walkthrough](#code-walkthrough) section of this article describes the remaining steps of the process.

## Code walkthrough

### Receive a message from the user and add it to an Azure Storage queue

When the bot receives a message from the user (step 2), it adds the message to the Azure Storage queue (step 3), and notifies the user (via the Bot Framework servers) that the message has been queued (step 4). 
The message is encapsulated within an object that contains information that will eventually be needed to send the proactive message to the user on the correct channel. 

This code snippet uses C# to receive a message from the user, add the message to the Azure Storage queue, and notify the user that the message has been queued. The [ResumptionCookie][resumptionCookie] object contains the information that is needed to respond to the user on the correct channel.

[!code-csharp[Receive message](~/includes/code/azure-bot-service-template-proactive.cs#receiveMessage)]

This code snippet uses Node.js to receive a message from the user, add the message to the Azure Storage queue, and notify the user that the message has been queued. The [session.message.address][sessionMessageAddress] object contains the information that is needed to respond to the user on the correct channel.

[!code-javascript[Receive message](~/includes/code/azure-bot-service-template-proactive.js#receiveMessage)]

### Trigger an Azure Function and send the message to the bot

After the message is added to the queue, the function is automatically triggered (step 5). The message is then removed from the queue and sent back to the bot (step 6). The function's configuration file (**functions.json**) contains an input binding of type `queueTrigger` and an output binding of type `bot`.

```json
{
  "bindings": [
    {
      "name": "myQueueItem",
      "type": "queueTrigger",
      "direction": "in",
      "queueName": "bot-queue",
      "connection": ""
    },
    {
      "type": "bot",
      "name": "$return",
      "direction": "out",
      "botId": "yourbot"
    },
    {
      "type": "http",
      "name": "res",
      "direction": "out"
    }
  ]
}
```

This code snippet shows the Function code in C#.

[!code-csharp[queue trigger](~/includes/code/azure-bot-service-template-proactive.cs#queueTrigger)]

This code snippet shows the Function code in Node.js.

[!code-javascript[queue trigger](~/includes/code/azure-bot-service-template-proactive.js#queueTrigger)]

### Receive the message from the Azure Function and send proactive message

Finally, the bot receives the message from the trigger function (step 7) and sends a proactive message to the user (step 8).

This code snippet uses C# to receive the message from the Azure Function and send a message to the user.

[!code-csharp[handle message from function](~/includes/code/azure-bot-service-template-proactive.cs#handleMessageFromFunction)]

This code snippet uses Node.js to receive the message from the Azure Function and send a message to the user.

[!code-javascript[handle message from function](~/includes/code/azure-bot-service-template-proactive.js#handleMessageFromFunction)]

## Extend default functionality

The Proactive template provides a good foundation that you can build upon and customize to enable proactive messaging scenarios for your bot. To learn more about sending proactive messages, see [Send proactive messages with .NET](~/dotnet/bot-builder-dotnet-proactive-messages.md) or [Send proactive messages with Node.js](~/nodejs/bot-builder-nodejs-proactive-messages.md). 

## Additional Resources

- [Create a bot with the Azure Bot Service](~/azure/azure-bot-service-quickstart.md)
- [Templates in the Azure Bot Service](~/azure/azure-bot-service-templates.md)
- <a href="https://azure.microsoft.com/en-us/documentation/services/functions/" target="_blank">Azure Functions</a>
- <a href="https://azure.microsoft.com/en-us/documentation/articles/functions-bindings-storage-queue" target="_blank">Azure Functions Storage queue bindings</a>
- [Send proactive messages with .NET](~/dotnet/bot-builder-dotnet-proactive-messages.md) 
- [Send proactive messages with Node.js](~/nodejs/bot-builder-nodejs-proactive-messages.md)
- <a href="https://github.com/Microsoft/BotBuilder-Samples" target="_blank">Bot Builder Samples GitHub repository</a>
- [Bot Builder SDK for .NET](~/dotnet/index.md)
- [Bot Builder SDK for Node.js](~/nodejs/index.md)

[directLine]: https://docs.botframework.com/en-us/restapi/directline3/#navtitle

[resumptionCookie]: https://docs.botframework.com/en-us/csharp/builder/sdkreference/dc/d2b/class_microsoft_1_1_bot_1_1_builder_1_1_dialogs_1_1_resumption_cookie.html

[sessionMessageAddress]: https://docs.botframework.com/en-us/node/builder/chat-reference/interfaces/_botbuilder_d_.iaddress.html