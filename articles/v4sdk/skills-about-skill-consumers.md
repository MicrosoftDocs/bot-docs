---
title: About skill consumers
description: Describes how conversational logic in a skill bot can be used by a skill consumer using the Bot Framework SDK.
keywords: bot skill, host bot, skill consumer.
author: JonathanFingold
ms.author: iawilt
manager: shellyha
ms.reviewer: Gabo.Gilabert
ms.service: bot-service
ms.topic: conceptual
ms.date: 11/02/2021
monikerRange: 'azure-bot-service-4.0'
---

# About skill consumers

[!INCLUDE [applies-to-v4](../includes/applies-to-v4-current.md)]

A _skill consumer_ is a bot that can call one or more skills.
With respect to skills, a _root bot_ is a user-facing bot that is also a skill consumer.

From the user's perspective, the root bot is the bot they are interacting with.
From the skill's perspective, the skill consumer is the channel over which it communicates with the user.
(For more information, see the [skills overview](skills-conceptual.md).)

As a skill consumer, a root bot includes some additional logic to manage traffic between it and a skill:

- Configuration information for each skill the root uses.
- A _conversation ID factory_ that allows the root to switch back and forth between the conversation it is having with the user and the one it is having with a skill.
- A _skill client_ that can package and forward activities to a skill bot.
- A _skill handler_ that can receive requests and unpack activities from a skill bot.

## Managing skills

Starting and letting a single skill run to completion is managed with a few additions to the skill consumer. More complex scenarios are possible, with multiple skills or conversation threads.

A skill consumer implements at least two HTTP endpoints:

- A _messaging endpoint_ receives activities from the user or channel. This is the usual messaging endpoint that all bots implement.
- A _skill host endpoint_ for receiving activities from a skill. This acts as a callback URL, the service URL to which the skill replies. (The skill consumer needs to pair code that receives the HTTP method request from the skill with a skill handler.)

### Skill descriptions

For each skill, add a _Bot Framework skill_ object to the skill consumer's configuration file. Each one will have an ID, an app ID, and an endpoint for the skill.

| Property | Description
| :--- | :--- |
| _ID_ | The ID or key of the skill, specific to the skill consumer. |
| _App ID_ | The `appId` assigned to the bot resource when the skill was registered on Azure. |
| _Skill endpoint_ | The messaging endpoint for the skill. This is the URL the consumer will use to communicate with the skill. |

### Skill client and skill handler

The skill consumer uses a skill client to send activities to a skill. The client:

- Takes an activity to send to the skill, either from a user or generated by the consumer.
- Sets the service URL on the activity sent to the skill to the consumer's skill host endpoint.
- Replaces the original conversation reference with one for the consumer-skill conversation.
- Adds a bot-to-bot authentication token.
- Sends the updated activity to the skill.

The skill consumer uses a skill handler to receive activities from a skill. The handler:

- Handles the channel service REST API methods.
- Enforces authentication and claims validation.
- Retrieves the original conversation reference.
- Generates an activity for the consumer's adapter. This activity will either signal that the skill has completed or be an activity to forward to the user.

## Manage a skill directly

You need to add logic to your skill consumer to track any active skills.
It is up to the consumer as to how it manages skills in general, whether it can maintain multiple active skills in parallel or not, and so on.
Specific scenarios to consider include:

- Initiating a new consumer-skill conversation. (This will be associated with a specific consumer-user conversation.)
  - To pass parameters to a skill, set the _value_ property in the initial activity to the skill.
- Continuing an existing consumer-skill conversation.
- Recognizing an `endOfConversation` activity from the skill as signalling an end of a consumer-skill conversation.
  - To retrieve any return value from a skill, check the activity's _value_ property.
  - To check why the skill is ending, check the activity's _code_ parameter, which could indicate that the skill encountered an error.
- Cancelling a skill from the consumer by sending an `endOfConversation` activity to the skill.

See how to [implement a skill consumer](skill-implement-consumer.md) for a consumer that manages a skill directly.

## Manage a skill using a skill dialog

If you are using the [dialogs library](bot-builder-concept-dialog.md), you can use a _skill dialog_ to manage a skill. While the skill dialog is the active dialog, it will forward activities to the associated skill.

- When you create the skill dialog, use the _dialog options_ parameter to provide all the information the dialog needs to manage the skill, such as the consumer's app ID and callback URL, the conversation ID factory to use, the skill's properties, and so on.
  - If you want to manage more than one skill as a dialog, you will need to create a separate skill dialog for each skill.
  - Often, you will add the skill dialog to a component dialog.
- To start the skill dialog, use the dialog context's _begin_ method and provide the skill dialog's ID. Use the _options_ parameter to provide the activity the consumer will send as the first activity to the skill.
- You can cancel or interrupt the skill dialog as you would any other dialog. See how to [handle user interruptions](bot-builder-howto-handle-user-interrupt.md) for an example.

See how to [use a dialog to consume a skill](skill-use-skilldialog.md) for a consumer that uses a dialog to manage a skill.

## Using a delivery mode of expect replies

Bots and skills use industry-standard REST and JSON over HTTPS for communication. Normal activity processing flow starts when the root bot receives a post from a channel at the its _messaging endpoint_. The root bot then sends the activity on to the skill for processing. Replies from the skill are posted back to the root bot's _skill host endpoint_, not the its messaging endpoint. Finally, the replies are processed further or posted back to the channel by the root bot. This normal flow can be altered by changing the _delivery mode_ of the activity sent to the skill. If _delivery mode_ is set to "ExpectReplies", the skill will not post back to the skill host endpoint.  Instead, all reply activities are serialized into the body of the response.  The root bot then iterates over these activities, processing them similar to how they would have been processed by the skill host endpoint.

For information, see the [Delivery mode](https://github.com/microsoft/botframework-sdk/blob/main/specs/botframework-activity/botframework-activity.md#delivery-mode) in the Activity specification.
